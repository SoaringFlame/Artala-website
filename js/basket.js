// Создание объекта для отслеживания товаров
var cartItems = {};
// Объявляем объект `cartItems`, который будет использоваться для хранения наименований товаров и их количеств в корзине.
// Ключи объекта представляют собой названия товаров, а значения — их количество.

function insertProductName(productName) {
    // Определяем функцию `insertProductName`, принимающую один аргумент `productName`, который представляет название продукта для добавления или обновления в корзине.

    var textarea = document.getElementById('text');
    // Получаем элемент текстового поля по его идентификатору 'text' и сохраняем его в переменной `textarea`.

    if (textarea.value !== '') {
        textarea.value += ', ';
    }
    // Проверяем, не пусто ли текстовое поле. Если оно содержит текст, добавляем к нему запятую и пробел для разделения элементов списка.

    // Проверка, есть ли товар уже в корзине
    if (cartItems.hasOwnProperty(productName)) {
        cartItems[productName] += 1; // Увеличение количества товара
    } else {
        cartItems[productName] = 1; // Добавление нового товара в корзину
    }
    // Проверяем, есть ли уже товар в объекте `cartItems` с помощью `hasOwnProperty`.
    // Если продукт уже добавлен, увеличиваем его количество на 1.
    // В противном случае добавляем товар в объект с начальным значением 1.

    // Обновление значения в текстовом поле
    textarea.value = formatCartItems();
    // Изменяем значение в элементе `textarea`, используя функцию `formatCartItems`, чтобы отобразить обновленный список товаров.

    // Отправка данных формы на сервер
    var xhr = new XMLHttpRequest();
    xhr.open('POST', 'sendmail.php', true);
    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    // Создаем объект `XMLHttpRequest` для отправки данных на сервер.
    // Метод `open` настраивает запрос POST, указывая URL 'sendmail.php' и устанавливая его асинхронность в true.
    // `setRequestHeader` устанавливает заголовок HTTP для данных формы.

    xhr.onreadystatechange = function () {
        if (xhr.readyState === 4 && xhr.status === 200) {
            // Обработка ответа сервера, если необходимо
        }
    };
    // Назначаем функции обратного вызова `onreadystatechange`, которая проверяет, завершен ли запрос (`readyState === 4`) и был ли успешно выполнен (`status === 200`).
    // Если условия соблюдены, можно добавить дополнительную логику для обработки ответа с сервера.

    var formData = 'cartItems=' + encodeURIComponent(JSON.stringify(cartItems));
    // Создаем данные формы из объекта `cartItems`, сериализуя его в JSON и кодируя в URL-формат.
    // `encodeURIComponent` используется для безопасного включения данных в URL.

    xhr.send(formData);
    // Отправляем собранные и подготовленные данные на сервер с помощью `send()`.

    // Перемещение на пункт с окошком с текстом
    window.location.href = '#text';
    // Изменяем URL страницы, чтобы автоматически прокрутить до ID элемента 'text' на странице.
}

// Форматирование списка товаров для отображения в текстовом поле
function formatCartItems() {
    var formattedItems = '';
    // Инициализируем пустую строку `formattedItems`, которая будет содержать отформатированный список товаров.

    // Проход по всем товарам в корзине
    for (var item in cartItems) {
        if (cartItems.hasOwnProperty(item)) {
            formattedItems += item + ' (x' + cartItems[item] + '), ';
        }
    }
    // Используем цикл `for...in` для итерации по свойствам объекта `cartItems`.
    // `hasOwnProperty` проверяет, принадлежит ли свойство самому объекту и не унаследовано ли от прототипа.
    // Для каждого товара добавляем его имя и количество (в формате x[количество]) в строку `formattedItems`, завершая запятой и пробелом.

    // Удаление лишней запятой и пробела в конце строки
    formattedItems = formattedItems.replace(/,\s$/, '');
    // Удаляем последнюю запятую и пробел из `formattedItems`, чтобы строка закончилась чисто, без лишних символов.

    return formattedItems;
    // Возвращаем отформатированную строку, которая будет вставлена в текстовое поле.
}
